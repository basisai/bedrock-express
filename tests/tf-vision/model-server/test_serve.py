from io import BytesIO
from unittest import TestCase

from serve import Model

soccer = b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00\x1c\x00\x00\x00\x1c\x08\x06\x00\x00\x00r\r\xdf\x94\x00\x00\x00\x01sRGB\x00\xae\xce\x1c\xe9\x00\x00\x00\x84eXIfMM\x00*\x00\x00\x00\x08\x00\x05\x01\x12\x00\x03\x00\x00\x00\x01\x00\x01\x00\x00\x01\x1a\x00\x05\x00\x00\x00\x01\x00\x00\x00J\x01\x1b\x00\x05\x00\x00\x00\x01\x00\x00\x00R\x01(\x00\x03\x00\x00\x00\x01\x00\x02\x00\x00\x87i\x00\x04\x00\x00\x00\x01\x00\x00\x00Z\x00\x00\x00\x00\x00\x00\x00H\x00\x00\x00\x01\x00\x00\x00H\x00\x00\x00\x01\x00\x03\xa0\x01\x00\x03\x00\x00\x00\x01\x00\x01\x00\x00\xa0\x02\x00\x04\x00\x00\x00\x01\x00\x00\x00\x1c\xa0\x03\x00\x04\x00\x00\x00\x01\x00\x00\x00\x1c\x00\x00\x00\x00\x97\x87\x99\xa1\x00\x00\x00\tpHYs\x00\x00\x0b\x13\x00\x00\x0b\x13\x01\x00\x9a\x9c\x18\x00\x00\x01YiTXtXML:com.adobe.xmp\x00\x00\x00\x00\x00<x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="XMP Core 5.4.0">\n   <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">\n      <rdf:Description rdf:about=""\n            xmlns:tiff="http://ns.adobe.com/tiff/1.0/">\n         <tiff:Orientation>1</tiff:Orientation>\n      </rdf:Description>\n   </rdf:RDF>\n</x:xmpmeta>\nL\xc2\'Y\x00\x00\x04\xafIDATH\r\x8d\x96\xc9+\xffO\x1c\xc7\xc7\xbeo\x85B!\xd9\x92".J\xe9sQ\xca\xc5A\x1c\x9c\\(\x17\xc9\xc5_\xe0JN\xca\xd1\xc1IJI)%[\xe4 \x07\xfb\x92}/\xd9w\xf3\x9b\xc7\xeb\xf7\x9d\xe9\xf3\xf9X\xfaL\xcdg\xe6=\xaf\xe5\xf9Zg>A\xda\x0c\x15\xe0\xf8\xfa\xfa\xfa\x913((H1\x03\x19\xa1\x810\xc1\x83]\xc1\xc1\xc1\x81\xb2\xff\xca\x170 \x1e\xec\xec\xec\xa8\xd5\xd5Uu\x7f\x7f\xaf>??Ull\xacJMMU%%%*>>\xfeW\x10\x1f\x02!\xfdk|||\x08yee\x85\xd0\xff8\xbb\xbb\xbb\xf5\xe3\xe3\xa3~{{\xd3&\xec\x7f\xa9\xd3AP},\xf8\xf7\xc1\xf1\xfb\xfb\xbb|\x85\x84\x84\xa8\x97\x97\x17\xf9\xbe\xbd\xbdU\xcb\xcb\xcbjqqQy<\x1eUVV&\xde\xc1\x83\xd7\xc6@\x15\x19\x19\xa9\xf8F\x87\x7fn\xbf\x01Z|\xc0\xd8\x87\x85\x85\x05\x94;x\x01D\xee\xf5\xf5U%$$\x08\x98?\xa8O\x15X"\xde\x98\xf0\xa8\xf0\xf0p\'\x04\x8dI\xa52\xd9\x03`\xbf\t\x85\xadV\xe4\x96\x96\x96$\xd7\x9c\xc1k\x87\x03\xe4\x10\xe2\xfe\xfe\xbe\xea\xe8\xe8PGGG\xf2\x8dB\xef\xe1\x1d"\xbb\xf7WJH\x91oii\x110\x1f\xba\x01r\x89>??wE\xb1\xb5\xb5\x05IS4\x06\xd4M[DB\xfc\xf7\xc3\x99\xf1VxMt\xb4\t\xa9\xde\xdc\xdc\x14]\x93\x93\x93\xc2\x05\x9d!\x1e\x9aU\x9c\x18\x1f\x1fw\xce\x10.\x064\xa6\r\x1d\xc5prr\xa2\xba\xba\xba\xd4\xc0\xc0\x80z~~\x96\x02\x81\xdf\xf2Y\x19\xe4\xfb\xfb\xfb%=\xf40\xe7(2\xab\x96\xb2\xae\xaa\xaa\xd2\xe9\xe9\xe9b\x19m\xc0\xa0\xd4M!\xb8(LLL\x08\x1d[\x98555\xe2\r\xbcxF{<==\xe9\x83\x83\x03]ZZ*<\x1b\x1b\x1b\x90%\n$^>\xd6\xd6\xd6\x9c\xa2\xde\xde^\x114\xd6kB\x04 \x8a\xfa\xfa\xfa\x84\'11Qgee\xe9\xbc\xbc<\'\x83!\xf0\x9a\xb6\xd1\xd7\xd7\xd7\xb2\x9a\x88\t}ll\xec;\xe0\xc8\xc8\x88\x10\xdb\xdb\xdb\xf5\xdd\xdd\x9dX\t\x08\x13\xc0\xed\xedm\xa1\xe7\xe7\xe7\xeb\x98\x98\x18\x07\xc47\x9e\xb6\xb6\xb6\n\xc8\xe5\xe5\xa5\xa6\x16\xce\xce\xce\xf4\xc5\xc5\x85nll\xd4===\x0e\xd0UiJJ\x8a\x91S\xaa\xad\xadMrB/\x91\x17&-\x02\xbd\xa9\xa9I\x99bR\x11\x11\x11\xc2\xcb\x0f}\xc7\xa8\xad\xad\x95~E\xce\xe6\x9b\xbc!c\xa2!<\xfc\x98\xb3\xff1\x0b\n\n\xd4\xc2\xc2\x82(\xa6\x0f\x8dIrkps\xa0\x84\xde\xaa\xac\xac\x14\xc1\xb8\xb881\x8a\xf2\xbf\xba\xba\x92\xb3\x9c\x9c\x1cer\xe7z\x91C\xf4\xe4\xe6\xe6\xaa\xf2\xf2r\xe1\xa1=\x9c\x87\x9cdgg\x0b\x88\xf5\xcc\xae\x802\x8b\x8b\x8bE044T\x00M.\xd5\xc3\xc3\x83\xea\xec\xec\x14C\x89\x04\x0e \x87r\xf8\x18\x18kG(\x9eX"\xaf@TT\x94\xa5\xc9j\x9b\x16k\xd3\xd2\xd2Taa\xa12U\xe7hl<\x1e\x8f\xbb$\xe0g\x00\x8cn\xc2\x1b\x1d\x1d-g\xfc\xb8\xbb\x94~:==\x95\xfc\xc0h\x87U\xc0\x8a0!\xc4\x13{\xc7\xa2\x98\xa7\x89\xfe\x84\x07\xaf\xac\x13\xa4\x02\xbd\xa6\xb0\x84\x8eN\xf7\x1e\xe2\x19B\x14\x01\x16\x11\x16\xf6\xac(E\x19aMNN\xf6\xb1\x1e%6\xf4\xf0\xa0\x03~\x8c\xe3e\xa1\xd88\xb3FH\x0e\xadGIII\xca\xb4\x84\x1a\x1d\x1dU\xbb\xbb\xbbR\x04\x96\x99\x90\xa2\x98\x95\xe2`\xb5\x13\xe5\x18\x03\x10\x1eQ\xc9\xa6\x97\x95i\rI\x03Fa\x8c\xac\x06L\xe2g-\xe0\xad\xe3\x8dcxLn***T}}\xbd\xa22\x01d \xec\x14\x98=\xb2\xb4\n/\xc4\xd0\xd0\x902=-|\xc7\xc7\xc7*##\xc3y\xc7\xa1\x0b\xa9p\x98\x1fs{\x08\x08-rxx\xa8\xa6\xa6\xa6$,uuu\x12b\x1b.\xcb\x8fw\xfc\xd5\xd8\xdb\xdbS\r\r\r.W\xc3\xc3\xc3\xdf\xc0D\x06\x0f\xed0\x1e\xc8\x96\x97\xc2\x10e\x9a\x1e\xd2&\xbfzffFn\x1b\xae\xc0\xf5\xf5u\x99\xe6\xff\x8d\xe6\x9e4\xaf\xbf\xae\xae\xaev2\x83\x83\x83V\xe5\xb7\x15w}\x86\x055\xe1\xd0\xcd\xcd\xcdN\x89\xb1^@\xb8\xe2xz\x00\xc2\xb0\xf9\xf9y\x9d\x99\x99)|EEEzvv\xd6\xe93\xde\xbb\xbd\xdd\xb8\xb6\xb0!b%L\x84\x8e\x9c\xcd\xcd\xcd\xa9\xe9\xe9iEA\x99\xdb\xdf\xb5\r<LswJ8I\x85ym\xa4E\x8crQg\xf3\xec\xad\xfbG@oP\xcbLO\xdd\xdc\xdcH\x85\x02D\xf5r\x83PL\xde\x7f\x11\xad\xb1V\xce\x7f\xfd\x15\x10F,ezW\xa5\xbf\x02\xfb\rP |\x7f\x02Ze\xac6L\xdegv\xffS\xe8,\xcd\x7f\xfd\x0f\xc4<\xa3\xb7\x1a\xf3\xf2\xe6\x00\x00\x00\x00IEND\xaeB`\x82'  # noqa: E501


class TestModelServer(TestCase):
    def test_validate(self):
        m = Model()
        result = m.validate(files={"image": BytesIO(soccer)}, skip_preprocess=True)
        self.assertIn("result", result)
        self.assertIn("prediction_id", result)
        self.assertEqual(len(result["prediction_id"].split("/")), 3)
        self.assertEqual(result["result"], [805])
